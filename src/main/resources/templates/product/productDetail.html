<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="/includes/headTag :: head_tag"></th:block>
<style>
   .product-container {
      display: flex;
      flex-wrap: wrap;
   }

   .product-info {
      width: 50%;
      margin-right: 20px;
   }

   .product-info img {
      width: 100%;
   }

   .recommendation-container {
      width: 50%;
   }

   .recommendation-container h3 {
      margin-top: 0;
   }

   .recommendation-list {
      display: flex;
      flex-wrap: wrap;
   }
</style>

<body style="">
   <script type="text/javascript" defer>

   </script>
   <!-- Page Preloder -->
   <div id="preloder" style="display: none;">
      s
      <div class="loader" style="display: none;"></div>
   </div>
   <th:block th:replace="/includes/header :: header1"></th:block>
   <th:block th:replace="/includes/header :: header2"></th:block>
   <th:block th:replace="/includes/header :: header3"></th:block>
   <!-- Header Section End -->
   <!-- Shop Details Section Begin -->
   <section class="shop-details">
      <div class="product__details__pic">
         <div class="container">
            <div class="row">
               <div class="col-lg-12">
                  <div class="product__details__breadcrumb">
                     <a href="./index.html">Home</a> <a href="./shop.html">Shop</a> <span>Product Details</span>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-lg-3 col-md-3"></div>
               <div class="tab-content">
                  <div class="tab-pane active" id="tabs-1" role="tabpanel">
                     <div class="product__details__pic__item">
                        <img id="mainImg" th:src="${Detail.pimg[0].pimg}" alt="">
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      </div>
      <div class="product__details__content">
         <div class="container">
            <div class="row d-flex justify-content-center">
               <div class="col-lg-8">
                  <div class="product__details__text">
                     <h4 th:text="${Detail.detail.pname}"></h4>
                     <div class="rating">
                        <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i class="fa fa-star"></i> <i
                           class="fa fa-star"></i> <i class="fa fa-star-o"></i> <span> - 5 Reviews</span>
                     </div>
                     <!--  <h3 th:text="${Detail.detail.pprice} + '원'"> -->
                     <h3 th:text="${#numbers.formatInteger(Detail.detail.pprice, 3, 'COMMA') + '원'}">
                        <span>3233333</span>
                     </h3>
                     <div class="product__details__cart__option">
                        <input type="checkbox" checked style="display : none;" name="cartlist" id="chk_-1">
                        <div class="quantity">
                           <div class="pro-qty">

                              <span class="fa fa-angle-up dec qtybtn"></span><span
                                 class="fa fa-angle-up dec qtybtn"></span><span
                                 class="fa fa-angle-up dec qtybtn"></span><span
                                 class="fa fa-angle-up dec qtybtn"></span><span
                                 class="fa fa-angle-up dec qtybtn"></span>
                              <input class="item" id="quantity-1" name='quantity' type="text" value="1">
                              <span class="fa fa-angle-down inc qtybtn"></span> <span
                                 class="fa fa-angle-down inc qtybtn"></span> <span
                                 class="fa fa-angle-down inc qtybtn"></span><span
                                 class="fa fa-angle-down inc qtybtn"></span> <span
                                 class="fa fa-angle-down inc qtybtn"></span>
                           </div>

                        </div>
                        <input class="item" id="pid-1" type="hidden" name='pid' th:value="${Detail.detail.pid}" />
                        <a href="#" id='addToCart' class="primary-btn">장바구니 담기</a> <a href="#"
                           class="primary-btn orderDirect">바로구매 하기</a>
                     </div>
                     <div class="product__details__last__option">
                        <h5>
                           <span>상품정보</span>
                        </h5>
                        <ul style="padding-top: 0;">
                           <li><span>상품번호 : </span>[[${Detail.detail.pid}]]</li>
                           <input type="hidden" name='pid' th:value="${Detail.detail.pid}" />
                           <li><span>Categories:</span> <b><span th:text="${Detail.detail.pcategory}"
                                    style="color: #111111"></span></b></li>
                           <li><span>원산지:</span><span th:text="${Detail.detail.porigin}" style="color: #111111"></span>
                           </li>

                           <br>
                           <li><span></span> &lt; 배송형태&gt;</li>
                           <li><span></span> 새벽배송 / 밤 11시까지 결제 시</li>
                           <li><span></span> 배송비 3,500원 (5만원 이상 구매 시 무료)</li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-lg-12">
                  <div class="product__details__tab">
                     <ul class="nav nav-tabs" role="tablist">
                        <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#tabs-5"
                              role="tab">상품설명</a></li>
                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#tabs-6" role="tab">리뷰</a></li>
                        <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#tabs-7" role="tab">반품 환불</a>
                        </li>
                     </ul>
                     <div class="tab-content" style="display: flex; justify-content: center;">
                        <div class="tab-pane active" id="tabs-5" role="tabpanel" style="width: 800px;">
                           <div class="product__details__tab__content"
                              style="display: flex; flex-direction: column; align-items: center;">
                              <img th:src="${Detail.pimg[1].pimg}" alt="">
                              <p class="note"></p>
                              <div class="product__details__tab__content__item">
                                 <h5 th:text="${Detail.detail.ptitle}"></h5>
                                 <p th:text="${Detail.detail.pdetail}"></p>
                              </div>
                              <img th:each="detail, i : ${Detail.pimg}"
                                 th:if="${i.index >= 2 and i.index <= #lists.size(Detail.pimg) - 1}"
                                 th:src="${detail.pimg}">

                              <p th:src="${Detail.detail.pbdesc}"></p>
                              <br>
                              <h5 th:text="${Detail.detail.pbname}"></h5>
                              <p th:text="${Detail.detail.pbsmall}"></p>
                              <p th:text="${Detail.detail.pbdesc}"></p>
                           </div>
                           <!--  <img th:src="${Detail.pimg[Detail.pimg.size() - 1].pimg}" /> -->
                        </div>
                     </div>
                     <div class="tab-pane" id="tabs-6" role="tabpanel">
                        <div class="product__details__tab__content"></div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      </div>
   </section>
   <!-- Shop Details Section End -->
   <!-- Related Section Begin -->
   <section class="related spad"></section>
   <!-- Related Section End -->
   <!-- Footer Section Begin -->
   <th:block th:replace="/includes/footer :: footer"></th:block>
   <!-- Footer Section End -->
   <!-- Code injected by live-server -->
	<script src="/js/dialog.js"></script>
   <!-- Code injected by live-server -->
   <script>
      function customConfirm(title, text, confirm, cancle) {
         Swal.fire({
            title: title,
            text: text,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonText: cancle,
            cancelButtonColor: '#d33',
            confirmButtonText: confirm
         }).then((result) => {
            if (result.isConfirmed) {
               location.href = '/cart/mycart';
            }
         })
      }

   </script>
   <!-- Code injected by live-server -->
   <script th:inline="javascript">
      /*<![CDATA[*/
      function addToCart(flag) {
         var isAdmin = /*[[${#authorization.expression('isAuthenticated()')}]]*/ false;
         console.log(isAdmin);
         if (!isAdmin) {
            Swal.fire({
               title: '로그인이 필요한 활동입니다.',
               text: "로그인 페이지로 이동하시겠습니까?",
               icon: 'info',
               showCancelButton: true,
               confirmButtonColor: '#3085d6',
               cancelButtonColor: '#d33',
               confirmButtonText: '네',
               cancelButtonText: '아니요'
            }).then((result) => {
               if (result.isConfirmed) {
                  location.href = "/member/login";
               }
            })
            return;
         }
         var pamounts = [];
         var pids = [];
         $("input[name=cartlist]:checked").each(function () {
            $(this).prop("checked", false);
            var pos = $(this).prop('id').split('_')[1];
            var pid = $('#pid' + pos).val();
            var quantity = $("#quantity" + pos).val();
            pids.push(pid);
            console.log(pos, pid, quantity);
            pamounts.push(quantity);
         })

         if (pamounts.length == 0) {
            Swal.fire({
               icon: 'error',
               title: '수량을 선택해주세요.',
               text: '수량을 0개 이상으로 선택 해주세요.'
            })
            return;

         }
         $.ajax({
            url: '/capi/insert',
            beforeSend: function (xhr) {
               xhr.setRequestHeader(header, token);
            },
            type: 'post',
            contentType: "application/json",
            data: JSON.stringify({
               pids: pids,
               pamounts: pamounts
            }),
            success: function (result) {
               console.log(result);
               showModal(result);

            }, error: function (err, xhr, status) {

               if (err.status == 405 || err.status == 400) {
                  customConfirm('장바구니에 존재하는 상품입니다.', '확인하러 이동하기', '장바구니로', '아니요');
               }
            }
         })
      };


      $("#addToCart").on("click", function () {
         addToCart();
      });
   /*]]>*/
   </script>

</body>